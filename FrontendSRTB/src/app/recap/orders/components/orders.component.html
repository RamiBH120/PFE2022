<nav class="navbar navbar-expand-lg navbar-dark shadow nav">
  <div class="container-fluid">
    <a style="cursor: pointer" class="navbar-brand" title="S.R.T.B." data-bs-toggle="modal" data-bs-target="#exampleModalDedicatFS">
    <img src="assets/srtb-logo.png" width="85px" height="50px" alt="srtb-logo"></a>

    <div class="modal fade" id="exampleModalDedicatFS" data-bs-keyboard="false" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
      <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
          <div class="modal-header">
            <h2 class="modal-title" id="exampleModalLabel">À propos</h2>
            <button type="button" class="btn-close m-2" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body">
            <div class="text-center">
              <h2>Ce projet est réalisé par : </h2>
              <br>
            </div>

            <div class="container">
              <div class="row">
                  <ul>
                    <div class="col-sm">
                      <li>Rami Ben Hamouda </li>
                    </div>
                    <div class="col-sm" style="position: relative;bottom:50%;left:70%">
                      <li>Mayssam Hedhli</li>
                    </div>
                  </ul>
              </div>
            </div>

            <div class="text-center">
            <p>Dans le cadre du projet de fin d'études.</p>
            <p>Pour l'année universitaire 2021/2022.</p>
              <p>Au sein de la Société Régionale de Transport de Bizerte.</p>
            <p>Chez la Faculté des Sciences de Bizerte.</p>
              <p>Merci pour tous qui ont contribué à la finition de ce projet!.</p>
            </div>

          </div>
          <div class="modal-footer">
            <button type="button" class="btn hhhrd m-1" style="width: 150px" data-bs-dismiss="modal">Fermer
              <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-x-circle-fill" viewBox="0 0 16 16">
                <path d="M16 8A8 8 0 1 1 0 8a8 8 0 0 1 16 0zM5.354 4.646a.5.5 0 1 0-.708.708L7.293 8l-2.647 2.646a.5.5 0 0 0 .708.708L8 8.707l2.646 2.647a.5.5 0 0 0 .708-.708L8.707 8l2.647-2.646a.5.5 0 0 0-.708-.708L8 7.293 5.354 4.646z"/>
              </svg></button>
          </div>


        </div>
      </div>
    </div>

    <div class="collapse navbar-collapse" id="navbarNavDropdown">
      <ul class="navbar-nav">
        <li class="nav-item" [routerLinkActive]="['active']" [routerLinkActiveOptions]="{exact:true}">
          <a class="nav-link" routerLink="Dashboard">Accueil</a>
        </li>
        <li class="nav-item dropdown" [routerLinkActive]="['active']" [routerLinkActiveOptions]="{exact:true}">
          <a class="nav-link dropdown-toggle" id="navbarDropdownMenuLink" role="button" aria-expanded="false" [matMenuTriggerFor]="menu1">
            Médecine de travail
          </a>
          <mat-menu #menu1="matMenu">
            <button mat-menu-item routerLink="VisitePage">Visite périodique</button>
          </mat-menu>
        </li>
        <li class="nav-item dropdown" [routerLinkActive]="['active']" [routerLinkActiveOptions]="{exact:true}">
          <a class="nav-link dropdown-toggle" id="navbarDropdownMenuLink2" role="button" aria-expanded="false" [matMenuTriggerFor]="menu">
            Assurance du groupe maladie
          </a>
          <mat-menu #menu="matMenu">
            <button mat-menu-item routerLink="MedecinPage">Gestion des médecins</button>
            <button mat-menu-item routerLink="PharmaciePage">Gestion des pharmacies</button>
            <button mat-menu-item routerLink="PraticienPage">Gestion des praticiens</button>
            <button mat-menu-item routerLink="ActeMedicalPage">Gestion des actes médicaux</button>
            <button mat-menu-item routerLink="BordereauxEnvoi">Gestion des bordereaux d'envoi</button>
            <button mat-menu-item routerLink="BordereauxReglement">Gestion des bordereaux de réglement</button>
          </mat-menu>
        </li>
      </ul>
    </div>

    <div>
      <button #btn data-bs-toggle="modal" style="visibility: hidden" data-bs-target="#exampleModalRefreshToken"></button>
      <div class="btn-group dropdown" *ngIf="user">
        <a class="nav-link dropdown-toggle" id="navbarDropdownMenuLink3" role="button" aria-expanded="false" style="color: white;" [matMenuTriggerFor]="menu2">
          {{ user.username }}
        </a>
        <ng-container *ngIf="!user.image">
          <img src="../../../../assets/profile-picture256.jpg" title="Image de Profile" width="40px" height="40px" class="border border-3 rounded-circle" alt="">
        </ng-container>
        <ng-container *ngIf="user.image">
          <img [src]="retrievedImage" title="Image de Profile" width="40px" height="40px" class="border border-3 rounded-circle" alt="">
        </ng-container>
        <mat-menu #menu2="matMenu">
          <button mat-menu-item  routerLink="ProfilePage">
            <svg xmlns="http://www.w3.org/2000/svg" enable-background="new 0 0 24 24" height="24px" viewBox="0 0 24 24" width="24px" fill="#000000"><g><rect fill="none" height="24" width="24"/></g><g><path d="M12,2C6.48,2,2,6.48,2,12s4.48,10,10,10s10-4.48,10-10S17.52,2,12,2z M12,6c1.93,0,3.5,1.57,3.5,3.5S13.93,13,12,13 s-3.5-1.57-3.5-3.5S10.07,6,12,6z M12,20c-2.03,0-4.43-0.82-6.14-2.88C7.55,15.8,9.68,15,12,15s4.45,0.8,6.14,2.12 C16.43,19.18,14.03,20,12,20z"/></g></svg>
            <span>Profile</span></button>
          <button mat-menu-item  (click)="logout()">
            <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 0 24 24" width="24px" fill="#000000"><path d="M0 0h24v24H0z" fill="none"/><path d="M17 7l-1.41 1.41L18.17 11H8v2h10.17l-2.58 2.58L17 17l5-5zM4 5h8V3H4c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h8v-2H4V5z"/></svg>
            <span>Déconnexion</span></button>
        </mat-menu>
      </div>
    </div>

  </div>
</nav>

<router-outlet></router-outlet>

<div class="modal fade" id="exampleModalRefreshToken" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-labelledby="exampleModalRefresh" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered modal-lg">
    <div class="modal-content">
      <div class="modal-header">
        <h2 class="modal-title" id="exampleModalRefresh">Renouveler la session</h2>
      </div>
      <div class="modal-body">

        <form #refreshForm="ngForm" class="p-3 form-group m-auto">

          <div class="alert alert-info text-center">Votre session a expirée!. Pour continuer votre travail et renouveler votre session, veuillez saisir vos données.</div>

          <div class="mb-3 m-auto" style="width: 450px">
            <label>Matricule S.R.T.B <span class="text-danger">*</span></label>
            <div class="input-group mb-1">
              <div class="input-group-prepend">
                <span class="input-group-text"><i class="fas fa-user"></i></span>
              </div>
              <input type="text" class="form-control" name="matricule" placeholder="Votre matricule"
                     [ngModel]="getMatricule()" required pattern="^[0-9]{2,}$"  #matricule="ngModel" autocomplete="off"
                     [class.is-invalid]="matricule.invalid && matricule.touched" readonly>
            </div>
            <ng-container *ngIf="matricule.errors && (matricule.invalid && matricule.touched)">
              <div class="alert alert-danger text-center" *ngIf="matricule.errors?.['required']" >Matricule est obligatoire!!</div>
              <div class="alert alert-danger text-center" *ngIf="matricule.errors?.['pattern']" >Matricule non valide</div>
            </ng-container>
          </div>


          <div class="mb-3 m-auto" style="width: 450px">
            <label>Mot de passe <span class="text-danger">*</span></label>
            <div class="input-group mb-1">
              <div class="input-group-prepend">
                <span class="input-group-text"><i class="fas fa-lock"></i></span>
              </div>
              <input [type]="fieldTextType ? 'text' : 'password'" class="form-control" id="exampleInputPassword1" placeholder="Votre mot de passe"
                     name="password" ngModel #password="ngModel" required autocomplete="off" pattern="^(?=.*\d)(?=.*[a-z])(?=.*[A-Z])(?=.*[^a-zA-Z0-9])(?!.*\s).{8,20}$"
                     [class.is-invalid]="password.invalid && password.touched"><br>
              <div class="input-group-append">
      <span class="input-group-text">
        <i class="fa" [ngClass]="{'fa-eye-slash': !fieldTextType,'fa-eye': fieldTextType}" (click)="toggleFieldTextType()"></i>
      </span></div>
            </div>
            <ng-container *ngIf="password.errors && (password.invalid && password.touched)">
              <div class="alert alert-danger text-center" *ngIf="password.errors?.['required']" >Mot de passe est obligatoire!!</div>
              <div class="alert alert-danger text-center" *ngIf="password.errors?.['pattern']" >Mot de passe non valide</div>
            </ng-container>
          </div>
          <div class="text-center">
            <button [disabled]="refreshForm.form.invalid || ok" (click)="refreshToken(matricule.value,password.value)" class="btn hhh mt-3 text-center" style="width: 250px">Valider vos données
              <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-key" viewBox="0 0 16 16">
                <path d="M0 8a4 4 0 0 1 7.465-2H14a.5.5 0 0 1 .354.146l1.5 1.5a.5.5 0 0 1 0 .708l-1.5 1.5a.5.5 0 0 1-.708 0L13 9.207l-.646.647a.5.5 0 0 1-.708 0L11 9.207l-.646.647a.5.5 0 0 1-.708 0L9 9.207l-.646.647A.5.5 0 0 1 8 10h-.535A4 4 0 0 1 0 8zm4-3a3 3 0 1 0 2.712 4.285A.5.5 0 0 1 7.163 9h.63l.853-.854a.5.5 0 0 1 .708 0l.646.647.646-.647a.5.5 0 0 1 .708 0l.646.647.646-.647a.5.5 0 0 1 .708 0l.646.647.793-.793-1-1h-6.63a.5.5 0 0 1-.451-.285A3 3 0 0 0 4 5z"/>
                <path d="M4 8a1 1 0 1 1-2 0 1 1 0 0 1 2 0z"/>
              </svg></button></div>
        </form>

      </div>
      <div class="modal-footer">
        <button [disabled]="!ok" (click)="ok=false" class="btn float-end yes m-1" style="width: 250px" data-bs-dismiss="modal">Continuer la session
          <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-box-arrow-in-right" viewBox="0 0 16 16">
            <path fill-rule="evenodd" d="M6 3.5a.5.5 0 0 1 .5-.5h8a.5.5 0 0 1 .5.5v9a.5.5 0 0 1-.5.5h-8a.5.5 0 0 1-.5-.5v-2a.5.5 0 0 0-1 0v2A1.5 1.5 0 0 0 6.5 14h8a1.5 1.5 0 0 0 1.5-1.5v-9A1.5 1.5 0 0 0 14.5 2h-8A1.5 1.5 0 0 0 5 3.5v2a.5.5 0 0 0 1 0v-2z"/>
            <path fill-rule="evenodd" d="M11.854 8.354a.5.5 0 0 0 0-.708l-3-3a.5.5 0 1 0-.708.708L10.293 7.5H1.5a.5.5 0 0 0 0 1h8.793l-2.147 2.146a.5.5 0 0 0 .708.708l3-3z"/>
          </svg></button>
      </div>


    </div>
  </div>
</div>
